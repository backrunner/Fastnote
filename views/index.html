<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Fastnote</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--import requirements-->
    <script>
        window.$ = window.jQuery = require('../node_modules/jquery/dist/jquery.min.js');
        require('../node_modules/bootstrap/dist/js/bootstrap.min.js');
    </script>
    <link rel="stylesheet" type="text/css" media="screen" href="css/main.css" />
    <link rel="stylesheet" href="../node_modules/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../node_modules/animate.css/animate.min.css">
</head>

<body>
    <!-- titlebar -->
    <div class="container-titlebar col-lg-12 drag">
        <div class="title">Fastnote</div>
        <div id="electron-titlebar" class="titlebar" style="z-index: 999;position: fixed !important;"></div>
    </div>
    <script>
        require('electron-titlebar');
    </script>
    <!-- infobar -->
    <div class="container-infobar"></div>
    <!-- notes -->
    <div class="container-main">
        <div class="note-list col-lg-12" id="note-list"></div>
        <!-- empty -->
        <div class="note-empty col-lg-12">
            <span>您还没有建立任何的笔记</br>在下方你可以快速新建新笔记</span>
        </div>
        <script>
            //保存所有的notes
            var notes = new Array();

            //显示没有笔记的界面
            function showNoteEmpty() {
                var node_empty = document.getElementsByClassName('note-empty')[0];
                var node_list = document.getElementsByClassName('note-list')[0];
                node_empty.setAttribute("style", "display:flex;");
                node_list.setAttribute("style", "display:none;");
            }
            //显示有笔记的界面
            function showNoteList() {
                var node_empty = document.getElementsByClassName('note-empty')[0];
                var node_list = document.getElementsByClassName('note-list')[0];
                node_empty.setAttribute("style", "display:none;");
                node_list.setAttribute("style", "display:block;");
            }
            //清空列表内的笔记DOM
            function clearNoteList() {
                var node_list = document.getElementsByClassName('note-list')[0];
                node_list.innerHTML = "";
            }
            //渲染一条笔记
            function renderNote(id, time, text) {
                var node_list = document.getElementsByClassName('note-list')[0];
                var html = '<div class="note" id="note_' + id + '"><div class="note-header"><p class="note-no">';
                html += '#' + id;
                html += '</p><p class="note-time">';
                html += time;
                html += '</p></div><div class="note-content"><p class="note-text">';
                html += text;
                html += '</p></div></div>';
                node_list.innerHTML += html;
            }
            //在顶部渲染Note
            function renderNoteAtTop(id, time, text) {
                //构造html
                var node_list = document.getElementsByClassName('note-list')[0];
                var html = '<div class="note" id="note_' + id + '"><div class="note-header"><p class="note-no">';
                html += '#' + id;
                html += '</p><p class="note-time">';
                html += time;
                html += '</p></div><div class="note-content"><p class="note-text">';
                html += text;
                html += '</p></div></div>';
                node_list.innerHTML = html + node_list.innerHTML;
                //animate
                $('#note_' + id).animateCss('fadeInLeft');
            }
            //添加笔记至Array
            function addNoteToArray(id, time, rawtime, text, offset, timezone) {
                var note = {
                    id: id,
                    time: time,
                    rawtime: rawtime,
                    text: text,
                    offset: offset,
                    timezone: timezone
                }
                notes.push(note);
            }
            //添加Note Obj至Array
            function addNoteObjToArray(note) {
                notes.push(note);
            }
            //刷新note-list
            function refreshNoteList() {
                clearNoteList(); //先清空                
                notes.sort(sortNotes); //排序
                notes.forEach(function (note) {
                    renderNote(note.id, note.time, note.text);
                });
                //绑定右键事件
                bindRightClickEvent();
            }
            //清空notes数组
            function clearNoteArray() {
                notes = new Array();
            }
            //排序笔记
            function sortNotes(a, b) {
                if (a.id > b.id) {
                    return -1;
                } else if (a.id < b.id) {
                    return 1;
                } else {
                    return 0;
                }
            }
        </script>
    </div>

    <!-- new note -->
    <div class="fixed col-lg-12">
        <div class="container-newnote">
            <div class="lbl">
                <label>新建笔记</label>
            </div>
            <div class="control">
                <textarea id="note-text"></textarea>
            </div>
        </div>
    </div>

    <!-- rightclick menu -->
    <div class="rightclickmenu">
        <div class="list-group">
            <button type="button" class="list-group-item">编辑</button>
            <button type="button" class="list-group-item">删除</button>
        </div>
    </div>

    <script>
        var noteid_clicked = -1;
        //右键菜单相关事件绑定
        function bindRightClickEvent() {
            $('.note').mousedown(function (e) {
                if (e.which == 3) {
                    $('.rightclickmenu').attr('style', 'display:block;' + 'left:' + e.clientX + 'px;top:' +
                        e.clientY +
                        'px;z-index:1000;');
                    isRightClickMenuOpened = true;
                    noteid_clicked = parseInt($(this).attr("id").replace('note_',''));
                    console.log(noteid_clicked);
                }
            });
        }
        $('body').mousedown(function (e) {
            if (e.which == 1) {
                $('.rightclickmenu').attr('style', 'display:none;');
                noteid_clicked = -1;
            }
        });
        $('#note-list').scroll(function () {
            $('.rightclickmenu').attr('style', 'display:none;');
            noteid_clicked = -1;
        });
    </script>

    <script>
        //import requirements
        $.getScript('../app/infobar.js'); //import by jQuery
        require('../app/notes.js');
    </script>
    <script>
        //load Animate CSS
        $.fn.extend({
            animateCss: function (animationName, callback) {
                var animationEnd = (function (el) {
                    var animations = {
                        animation: 'animationend',
                        OAnimation: 'oAnimationEnd',
                        MozAnimation: 'mozAnimationEnd',
                        WebkitAnimation: 'webkitAnimationEnd',
                    };

                    for (var t in animations) {
                        if (el.style[t] !== undefined) {
                            return animations[t];
                        }
                    }
                })(document.createElement('div'));

                this.addClass('animated ' + animationName).one(animationEnd, function () {
                    $(this).removeClass('animated ' + animationName);

                    if (typeof callback === 'function') callback();
                });

                return this;
            },
        });
    </script>
</body>

</html>